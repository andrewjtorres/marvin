resources:
  containers:
    - container: node10
      image: node:10.15.3
    - container: node11
      image: node:11.12.0
    - container: python3
      image: ajtorres9/marvin-python:3.7.2
jobs:
  - job: root
    strategy:
      matrix:
        node10:
          container: node10
        node11:
          container: node11
    pool:
      vmImage: ubuntu-16.04
    container: $[variables['container']]
    steps:
      - checkout: self
      - script: yarn --no-progress install
      - script: yarn --silent prettylint --ignore-path .gitignore '**/*.{json,md,yml}' '!packages/**'
  - job: ai
    strategy:
      matrix:
        python3:
          container: python3
    pool:
      vmImage: ubuntu-16.04
    container: $[variables['container']]
    steps:
      - checkout: self
      - script: yarn --no-progress install
      - script: |
          poetry install
          mkdir --parents reports/junit
          yarn --silent lint-misc
          yarn --silent lint-scripts --format junit-xml --output-file reports/junit/lint-scripts-results.xml
          yarn --silent test-units --junitxml reports/junit/test-units-results.xml
        workingDirectory: packages/ai
      - task: PublishTestResults@2
        condition: succeededOrFailed()
        inputs:
          testResultsFiles: packages/ai/reports/junit/*-results.xml
